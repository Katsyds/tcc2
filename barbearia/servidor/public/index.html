<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Barbearia</title>
</head>
<body>
    <header>
        <nav>
            <div class="logo">Barbearia Tradicional</div>
            <ul>
                <li><a href="#about">Sobre Nós</a></li>
                <li><a href="#services">Serviços</a></li>
                <li><a href="#gallery">Galeria</a></li>
                <li><a href="#testimonials">Depoimentos</a></li>
                <li><a href="#contact">Contato</a></li>
            </ul>
        </nav>
    </header>

    <section id="hero">
        <div class="hero-content">
            <div class="banner">
            <div class="content-container">
            <h1>Seja Bem-Vindo à Nossa Barbearia</h1>
            <p>Experimente nossos serviços premium para um visual impecável.</p>
            <a href="#contact" class="btn">Agende um Horário</a>
            </div>
            </div>
        </div>
    </section>

    <section id="about" class="content-block">
        <h2>Sobre Nós</h2>
        <p>Oferecemos os melhores serviços de barbearia, com uma equipe experiente e produtos de qualidade.</p>
    </section>

    <section id="services" class="content-block">
        <h2>Serviços</h2>
        <ul class="services-list">
            <li><span class="service-icon">&#9733;</span> Corte de Cabelo</li>
            <li><span class="service-icon">&#9733;</span> Barba e Bigode</li>
            <li><span class="service-icon">&#9733;</span> Tratamentos Faciais</li>
            <li><span class="service-icon">&#9733;</span> Massagem Capilar</li>
        </ul>
    </section>

    <section id="gallery" class="content-block">
        <h2>Galeria</h2>
        <div class="image-gallery">
            <img src="img/img4.jpg" alt="Serviço 1">
            <img src="img/img2.jpg" alt="Serviço 2">
            <img src="img/img5.jpg" alt="Serviço 3">
            <!-- Adicione mais imagens aqui -->
        </div>
    </section>

    <section id="testimonials" class="content-block">
        <h2>Depoimentos</h2>
        <div class="testimonial">
            <blockquote>
                "Excelente atendimento e profissionais competentes. Sempre saio satisfeito!"
            </blockquote>
            <p>- Cliente Satisfeito</p>
        </div>
        <div class="testimonial">
            <blockquote>
                "A barbearia oferece um ambiente acolhedor e os cortes de cabelo são impecáveis."
            </blockquote>
            <p>- Cliente Feliz</p>
        </div>
    </section>

    <section id="contact" class="content-block">
        <form id="reservation-form">
            <h3>Agende um Horário</h3>
            <label for="name">Nome:</label>
            <input type="text" id="name" name="name" required>
            <label for="numero">número:</label>
            <input type="tel" id="numero" name="numero" required>
            <label for="service">Serviço:</label>
            <select id="service" name="service" required>
                <option value="corte">Corte de Cabelo</option>
                <option value="barba">Barba</option>
                <option value="cortebarba">Corte e Barba</option>
            </select>
            <label for="date" max="2024-04-30">Data:</label>
            <input type="date" id="date" name="date" min="2023-04-01" max="2023-12-30" required>
            
            <label for="time">Horário:</label>
<div id="horario-buttons">
    <button class="horario-button" id="horario-10" data-horario="10:00">10:00</button>
    <button class="horario-button" id="horario-11" data-horario="11:00">11:00</button>
    <button class="horario-button" id="horario-12" data-horario="12:00">12:00</button>
    <button class="horario-button" id="horario-13" data-horario="13:00">13:00</button>
    <button class="horario-button" id="horario-14" data-horario="14:00">14:00</button>
    <button class="horario-button" id="horario-15" data-horario="15:00">15:00</button>
    <button class="horario-button" id="horario-16" data-horario="16:00">16:00</button>
    <button class="horario-button" id="horario-17" data-horario="17:00">17:00</button>
    <!-- Adicione mais botões para outros horários -->
</div>




            <button type="button" class="btn" id="agendar-button">Agendar</button>
            <h5>Por favor, reserve seu horário com pelo menos um dia de antecedência. Horários para o dia atual estarão indisponíveis.</hh5>
        </form>
    </section>

    <footer>
        <p>&copy; 2023 Barbearia Tradicional. Todos os direitos reservados.</p>
    </footer>

    <script>
        

        let horarioSelecionado = null; // Variável para armazenar o horário selecionado
    
        // Adicione um ouvinte de evento a cada botão de horário
const buttons = document.querySelectorAll('.horario-button');
buttons.forEach(button => {
    button.addEventListener('click', (event) => {
        event.preventDefault(); // Evita a recarga da página

        // Limpa a seleção de horário em todos os botões
        buttons.forEach(btn => {
            btn.classList.remove('selecionado');
        });

        // Define o botão atual como selecionado
        button.classList.add('selecionado');

        // Define o horário selecionado como o último horário clicado
        horarioSelecionado = button.textContent;
    });
});

    
        // Evento para capturar a seleção da data
document.getElementById('date').addEventListener('change', async () => {
    // Obtém a data selecionada
    const dataSelecionada = document.getElementById('date').value;

    // Atualiza as classes CSS dos botões com base na disponibilidade do horário para a nova data
    buttons.forEach(async btn => { // Adicione "async" aqui
        const horario = btn.textContent;
        const horarioOcupado = await verificarHorarioOcupado(dataSelecionada, horario);
        btn.classList.toggle('horario-disponivel', !horarioOcupado);
        btn.classList.toggle('horario-ocupado', horarioOcupado);
    });
});

    
        document.getElementById('agendar-button').addEventListener('click', async () => {
            const nome = document.getElementById('name').value;
            const numero = document.getElementById('numero').value;
            const servico = document.getElementById('service').value;
            const data = document.getElementById('date').value;
    
            // Verifica se um horário foi selecionado
            if (horarioSelecionado === null) {
                alert('Por favor, selecione um horário disponível.');
                return; // Não continue o envio do formulário se nenhum horário estiver selecionado
            }
    
            // Verifica se o nome e o numero foram preenchidos
            if (!nome || !numero) {
                alert('Por favor, preencha os campos de nome e numero.');
                return; // Não continue o envio do formulário se nome e/ou numero estiverem em branco
            }
    
            // Se todas as validações passarem, enviar o formulário
            const agendamentoData = {
                nome,
                numero,
                servico,
                data,
                horario: horarioSelecionado, // Usar o último horário selecionado
            };
    
            try {
                const response = await fetch('/agendamento', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(agendamentoData),
                });
    
                if (response.ok) {
                    const message = await response.text();
                    console.log(message);
                } else {
                    console.error('Erro ao enviar o formulário de agendamento.');
                    alert("horario indisponivel")
                }
            } catch (error) {
                console.error('Erro ao processar a solicitação:', error);
            }
        });
    
        // Função para verificar se um horário está ocupado para uma data
        async function verificarHorarioOcupado(data, horario) {
            try {
                const response = await fetch(`/verificarHorarioOcupado?data=${data}&horario=${horario}`, {
                    method: 'GET',
                });
    
                if (response.ok) {
                    const resultado = await response.json();
                    return resultado.ocupado;
                } else {
                    console.error('Erro ao verificar horário ocupado.');
                    return false;
                }
            } catch (error) {
                console.error('Erro ao verificar horário ocupado:', error);
                return false;
            }
        }
         // Evento para capturar a seleção da data e atualizar os botões de horário
         document.getElementById('date').addEventListener('change', async () => {
            const selectedDate = new Date(document.getElementById('date').value);
            const today = new Date();
            const buttons = document.querySelectorAll('.horario-button');

            buttons.forEach(button => {
                const buttonTime = parseInt(button.textContent);
                if (selectedDate < today || (selectedDate.getTime() === today.getTime() && buttonTime < today.getHours())) {
                    button.classList.add('horario-passado');
                } else {
                    button.classList.remove('horario-passado');
                }
            });

            // Restante do seu código dentro do evento de mudança de data
            // Obtém a data selecionada
            const dataSelecionada = document.getElementById('date').value;

            // Atualiza as classes CSS dos botões com base na disponibilidade do horário para a nova data
            buttons.forEach(async btn => { // Adicione "async" aqui
                const horario = btn.textContent;
                const horarioOcupado = await verificarHorarioOcupado(dataSelecionada, horario);
                btn.classList.toggle('horario-disponivel', !horarioOcupado);
                btn.classList.toggle('horario-ocupado', horarioOcupado);
            });
        });
    </script>
    
</body>
</html>
